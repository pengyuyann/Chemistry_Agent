# åŒ–å­¦æ™ºèƒ½åŠ©æ‰‹å‰ç«¯ - æ–°å¢åŠŸèƒ½ç‰¹æ€§

## ğŸ§ª åŒ–å­¦åˆ†å­å¯è§†åŒ–

### ChemicalViewer ç»„ä»¶
- **åŠŸèƒ½**: è‡ªåŠ¨æ£€æµ‹å¹¶å¯è§†åŒ–SMILESåˆ†å­ç»“æ„
- **API**: ä½¿ç”¨CDK DepictæœåŠ¡ç”Ÿæˆåˆ†å­ç»“æ„å›¾
- **ç‰¹æ€§**: 
  - å®æ—¶é¢„è§ˆåˆ†å­ç»“æ„
  - æ”¯æŒå¤šç§åˆ†å­æ ¼å¼
  - é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
  - å¯è‡ªå®šä¹‰å°ºå¯¸å’Œæ ‡é¢˜

### ä½¿ç”¨ç¤ºä¾‹
```tsx
import ChemicalViewer from './components/ChemicalViewer';

<ChemicalViewer 
  smiles="CCO" 
  width={200} 
  height={120} 
  title="ä¹™é†‡åˆ†å­ç»“æ„" 
/>
```

## ğŸ”¬ å¢å¼ºç‰ˆæ¶ˆæ¯ç»„ä»¶

### EnhancedMessageItem ç»„ä»¶
- **åŠŸèƒ½**: æ™ºèƒ½æ£€æµ‹å’Œæ¸²æŸ“åŒ–å­¦å†…å®¹
- **ç‰¹æ€§**:
  - è‡ªåŠ¨è¯†åˆ«SMILESåˆ†å­è¡¨ç¤º
  - æ£€æµ‹åŒ–å­¦ååº”è¡¨è¾¾å¼
  - é›†æˆåˆ†å­ç»“æ„å¯è§†åŒ–
  - å¢å¼ºçš„æ€è€ƒè¿‡ç¨‹å±•ç¤º
  - åŒ–å­¦å†…å®¹æ ‡ç­¾æ ‡è¯†

### åŒ–å­¦å†…å®¹æ£€æµ‹
- **SMILESæ£€æµ‹**: ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¯†åˆ«åˆ†å­ç»“æ„
- **ååº”æ£€æµ‹**: è¯†åˆ«åŒ–å­¦ååº”è¡¨è¾¾å¼
- **æ™ºèƒ½è¿‡æ»¤**: è¿‡æ»¤æ— æ•ˆçš„åŒ–å­¦è¡¨ç¤º

## ğŸ› ï¸ åŒ–å­¦å·¥å…·é¢æ¿

### ChemicalToolPanel ç»„ä»¶
- **åŠŸèƒ½**: æä¾›å¸¸ç”¨åŒ–å­¦å·¥å…·çš„å¿«æ·æ“ä½œ
- **å·¥å…·åˆ—è¡¨**:
  1. **åˆ†å­åç§°è½¬SMILES**: å°†åŒ–å­¦åç§°è½¬æ¢ä¸ºSMILES
  2. **SMILESè½¬åˆ†å­åç§°**: å°†SMILESè½¬æ¢ä¸ºåŒ–å­¦åç§°
  3. **åˆ†å­é‡è®¡ç®—**: è®¡ç®—åˆ†å­é‡
  4. **å®‰å…¨æ€§æ£€æŸ¥**: æ£€æŸ¥åˆ†å­å®‰å…¨æ€§å’Œæ¯’æ€§
  5. **ååº”é¢„æµ‹**: é¢„æµ‹åŒ–å­¦ååº”äº§ç‰©
  6. **é€†åˆæˆåˆ†æ**: åˆ†æåˆ†å­åˆæˆè·¯å¾„

### å·¥å…·ä½¿ç”¨æµç¨‹
1. ç‚¹å‡»å·¥å…·æŒ‰é’®
2. åœ¨å¼¹å‡ºçš„æ¨¡æ€æ¡†ä¸­è¾“å…¥å‚æ•°
3. ç³»ç»Ÿè‡ªåŠ¨å°†å·¥å…·è¯·æ±‚æ·»åŠ åˆ°å¯¹è¯ä¸­
4. AIåŠ©æ‰‹ä½¿ç”¨ç›¸åº”å·¥å…·è¿›è¡Œåˆ†æ

## ğŸ¨ å¢å¼ºç‰ˆèŠå¤©ç•Œé¢

### EnhancedChatInterface ç»„ä»¶
- **åŠŸèƒ½**: é›†æˆæ‰€æœ‰åŒ–å­¦åŠŸèƒ½çš„å®Œæ•´èŠå¤©ç•Œé¢
- **ç‰¹æ€§**:
  - ä¾§è¾¹æ åŒ–å­¦å·¥å…·é¢æ¿
  - å®æ—¶æµå¼æ¶ˆæ¯å¤„ç†
  - åŒ–å­¦å†…å®¹è‡ªåŠ¨æ£€æµ‹å’Œå¯è§†åŒ–
  - èŠå¤©è®°å½•å¯¼å‡ºåŠŸèƒ½
  - å“åº”å¼è®¾è®¡

### ç•Œé¢å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åŒ–å­¦å·¥å…·é¢æ¿    â”‚          èŠå¤©åŒºåŸŸ            â”‚
â”‚                 â”‚                             â”‚
â”‚ â€¢ åˆ†å­è½¬æ¢å·¥å…·    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â€¢ è®¡ç®—å·¥å…·       â”‚  â”‚      æ¶ˆæ¯åˆ—è¡¨            â”‚ â”‚
â”‚ â€¢ åˆ†æå·¥å…·       â”‚  â”‚  â€¢ ç”¨æˆ·æ¶ˆæ¯              â”‚ â”‚
â”‚                 â”‚  â”‚  â€¢ AIå›å¤                â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â€¢ åˆ†å­ç»“æ„å¯è§†åŒ–        â”‚ â”‚
â”‚ â”‚ å·¥å…·å¿«æ·æ“ä½œ  â”‚ â”‚  â”‚  â€¢ æ€è€ƒè¿‡ç¨‹å±•ç¤º          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 â”‚                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ èŠå¤©æ§åˆ¶     â”‚ â”‚  â”‚      è¾“å…¥åŒºåŸŸ            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æŠ€æœ¯å®ç°

### åˆ†å­ç»“æ„å¯è§†åŒ–
```typescript
// ä½¿ç”¨CDK Depict API
const fetchMoleculeSVG = async (smilesString: string) => {
  const url = "https://www.simolecule.com/cdkdepict/depict/wob/svg";
  const params = new URLSearchParams({
    smi: smilesString,
    annotate: "colmap",
    zoom: "2",
    w: width.toString(),
    h: height.toString(),
    abbr: "off",
  });
  
  const response = await fetch(`${url}?${params}`);
  const svgText = await response.text();
  return svgText;
};
```

### SMILESæ£€æµ‹ç®—æ³•
```typescript
const SMILES_REGEX = /([A-Z][a-z]?|[0-9]+|[()\[\]{}@%+=#$:;\\/|~!&?<>{}"`'*\-])+/g;

const extractSMILES = (text: string): string[] => {
  const matches = text.match(SMILES_REGEX);
  if (!matches) return [];
  
  return matches.filter(match => {
    const hasValidChars = /^[A-Za-z0-9()[\]{}@%+=#$:;\\/|~!&?<>"`'*\-]+$/.test(match);
    const hasReasonableLength = match.length >= 3 && match.length <= 200;
    const hasChemicalElements = /[CHNOPSFIBrCl]/i.test(match);
    
    return hasValidChars && hasReasonableLength && hasChemicalElements;
  });
};
```

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### 1. åˆ†å­ç»“æ„åˆ†æ
- è¾“å…¥: "åˆ†æè‹¯é…šçš„åˆ†å­ç»“æ„"
- è¾“å‡º: è‡ªåŠ¨æ˜¾ç¤ºè‹¯é…šçš„åˆ†å­ç»“æ„å›¾å’Œç›¸å…³åŒ–å­¦ä¿¡æ¯

### 2. åŒ–å­¦ååº”é¢„æµ‹
- è¾“å…¥: "é¢„æµ‹ä¹™é†‡å’Œä¹™é…¸çš„é…¯åŒ–ååº”"
- è¾“å‡º: æ˜¾ç¤ºååº”æ–¹ç¨‹å¼å’Œäº§ç‰©ç»“æ„

### 3. å®‰å…¨æ€§è¯„ä¼°
- è¾“å…¥: "æ£€æŸ¥ç”²é†‡çš„å®‰å…¨æ€§"
- è¾“å‡º: æ˜¾ç¤ºç”²é†‡ç»“æ„å›¾å’Œæ¯’æ€§åˆ†æ

### 4. åˆ†å­é‡è®¡ç®—
- è¾“å…¥: "è®¡ç®—è‘¡è„ç³–çš„åˆ†å­é‡"
- è¾“å‡º: æ˜¾ç¤ºè‘¡è„ç³–ç»“æ„å’Œåˆ†å­é‡è®¡ç®—ç»“æœ

## ğŸš€ æœªæ¥æ‰©å±•

### è®¡åˆ’åŠŸèƒ½
1. **3Dåˆ†å­å¯è§†åŒ–**: é›†æˆ3Dåˆ†å­ç»“æ„æ˜¾ç¤º
2. **å…‰è°±åˆ†æ**: æ˜¾ç¤ºIRã€NMRç­‰å…‰è°±æ•°æ®
3. **æ•°æ®åº“é›†æˆ**: è¿æ¥åŒ–å­¦æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢
4. **ååº”è·¯å¾„å¯è§†åŒ–**: æ˜¾ç¤ºå¤šæ­¥ååº”çš„è·¯å¾„å›¾
5. **åˆ†å­æ€§è´¨é¢„æµ‹**: é¢„æµ‹åˆ†å­çš„ç‰©ç†åŒ–å­¦æ€§è´¨

### æŠ€æœ¯ä¼˜åŒ–
1. **ç¼“å­˜æœºåˆ¶**: ç¼“å­˜å¸¸ç”¨çš„åˆ†å­ç»“æ„å›¾
2. **ç¦»çº¿æ”¯æŒ**: æ”¯æŒç¦»çº¿åˆ†å­ç»“æ„ç”Ÿæˆ
3. **æ€§èƒ½ä¼˜åŒ–**: ä¼˜åŒ–å¤§é‡åˆ†å­çš„æ¸²æŸ“æ€§èƒ½
4. **ç§»åŠ¨ç«¯é€‚é…**: ä¼˜åŒ–ç§»åŠ¨è®¾å¤‡ä¸Šçš„æ˜¾ç¤ºæ•ˆæœ

## ğŸ“ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„åŒ–å­¦å·¥å…·
1. åœ¨`ChemicalToolPanel`ä¸­æ·»åŠ å·¥å…·å®šä¹‰
2. å®ç°å·¥å…·çš„å‚æ•°è¾“å…¥ç•Œé¢
3. åœ¨`EnhancedMessageItem`ä¸­æ·»åŠ ç›¸åº”çš„æ¸²æŸ“é€»è¾‘
4. æ›´æ–°APIæ¥å£ä»¥æ”¯æŒæ–°å·¥å…·

### è‡ªå®šä¹‰åˆ†å­å¯è§†åŒ–
1. ä¿®æ”¹`ChemicalViewer`ç»„ä»¶çš„æ ·å¼
2. è°ƒæ•´CDK Depict APIçš„å‚æ•°
3. æ·»åŠ è‡ªå®šä¹‰çš„åˆ†å­æ¸²æŸ“é€»è¾‘

### æ‰©å±•åŒ–å­¦å†…å®¹æ£€æµ‹
1. æ›´æ–°æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼
2. æ·»åŠ æ–°çš„åŒ–å­¦æ ¼å¼æ”¯æŒ
3. ä¼˜åŒ–æ£€æµ‹ç®—æ³•çš„å‡†ç¡®æ€§

---

*æœ¬æ–‡æ¡£æè¿°äº†åŒ–å­¦æ™ºèƒ½åŠ©æ‰‹å‰ç«¯çš„åŒ–å­¦åŠŸèƒ½ç‰¹æ€§ï¼ŒåŒ…æ‹¬åˆ†å­å¯è§†åŒ–ã€å·¥å…·é›†æˆå’Œç”¨æˆ·ç•Œé¢ä¼˜åŒ–ã€‚* 