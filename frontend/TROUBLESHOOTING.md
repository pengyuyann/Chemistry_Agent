# 故障排除指南

## HTTP 422 错误解决方案

### 问题描述
```
INFO: 127.0.0.1:61113 - "POST /api/chemagent/stream_chat HTTP/1.1" 422 Unprocessable Entity
```

### 可能原因和解决方案

#### 1. 用户认证问题
**症状**: 422错误，提示认证失败
**解决方案**:
1. 确保用户已登录
2. 检查浏览器控制台是否有认证相关错误
3. 访问 `/api-test` 页面检查用户状态
4. 如果token过期，重新登录

#### 2. 请求格式错误
**症状**: 422错误，提示请求格式不正确
**解决方案**:
1. 检查请求体是否包含所有必需字段
2. 确保字段类型正确
3. 验证API端点URL是否正确

#### 3. 后端服务问题
**症状**: 422错误，后端日志显示验证失败
**解决方案**:
1. 检查后端服务是否正常运行
2. 验证环境变量配置
3. 检查数据库连接
4. 查看后端日志获取详细错误信息

### 调试步骤

#### 步骤1: 检查用户认证状态
1. 访问 `http://localhost:3000/api-test`
2. 查看用户信息是否正确显示
3. 如果显示"未登录"，请先登录

#### 步骤2: 测试API连接
1. 在API测试页面输入简单的测试内容
2. 点击"测试API连接"按钮
3. 查看控制台输出的详细错误信息

#### 步骤3: 检查网络请求
1. 打开浏览器开发者工具
2. 切换到Network标签页
3. 发送测试请求
4. 查看请求和响应的详细信息

#### 步骤4: 验证后端服务
1. 检查后端服务是否在端口8000运行
2. 访问 `http://localhost:8000/health` 检查健康状态
3. 查看后端日志文件

### 常见错误代码

| 错误代码 | 含义 | 解决方案 |
|---------|------|----------|
| 401 | 未授权 | 重新登录 |
| 422 | 请求格式错误 | 检查请求体格式 |
| 500 | 服务器内部错误 | 检查后端日志 |
| 404 | 端点不存在 | 检查API URL |

### 请求格式示例

正确的请求格式应该是：
```json
{
  "input": "计算苯的分子量",
  "conversation_id": null,
  "model": "deepseek-chat",
  "tools_model": "deepseek-chat",
  "temperature": 0.1,
  "max_iterations": 15,
  "streaming": true,
  "local_rxn": false,
  "api_keys": {}
}
```

### 环境检查清单

- [ ] 后端服务正在运行 (端口8000)
- [ ] 前端服务正在运行 (端口3000)
- [ ] 用户已登录并获取到token
- [ ] 网络连接正常
- [ ] 浏览器控制台无JavaScript错误
- [ ] 后端日志无错误信息

### 联系支持

如果问题仍然存在，请提供以下信息：
1. 浏览器控制台的完整错误信息
2. 后端服务的日志输出
3. 网络请求的详细信息
4. 使用的浏览器和操作系统版本

---

*最后更新: 2024年12月* 